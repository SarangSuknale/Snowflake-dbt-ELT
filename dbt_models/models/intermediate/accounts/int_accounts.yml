
models:
  - name: int_accounts
    description: >
              This intermediate model represents a unified view of financial accounts
              across all supported aggregation providers, including Source 1, Source 2,
              and Source 3. It standardizes account attributes, balances, statuses,
              freshness indicators, and account age metrics into a single schema.
              Each row represents one financial account owned by a user and is designed
              to serve as the foundation for downstream account-level marts and reporting.

    meta:
      owner: Sarang Suknale
      domain: accounts
      source_system: multi_provider
      maturity: intermediate
      pii: false
      providers:
        - Source 1
        - Source 2
        - Source 3
      tags:
        - accounts
        - intermediate
        - unified

    columns:
      - name: account_id
        description: Unique identifier for the financial account across providers.
        tests:
          - not_null
          - unique

      - name: user_id
        description: Unique identifier of the user who owns the account.
        meta:
          pii: true
          sensitivity: high
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_users')
                field: user_id

      - name: account_number_last4
        description: Masked account number showing only the last four digits.
        meta:
          pii: true
          masked: true

      - name: account_type
        description: Normalized account type derived from provider-specific values.
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - Saving
                  - Checking
                  - Loan
                  - Credit
                  - Investment
              severity: warn

      - name: account_subtype
        description: More granular classification of the account type, when available.

      - name: account_status
        description: Normalized status of the account across all providers.

      - name: current_balance
        description: Current total balance of the account.

      - name: available_balance
        description: Amount of funds currently available for use.

      - name: balance_diffrence
        description: Difference between the current balance and available balance.

      - name: available_credit
        description: Available credit amount for credit-based accounts.

      - name: credit_utilization_ratio
        description: Ratio of used credit to total available credit for the account.
                     Calculated using the most relevant balance and credit fields
                     across providers.

      - name: currency
        description: Currency code in which the account balances are recorded.

      - name: balance_date
        description: Date when the account balance was last updated.

      - name: days_since_balance_check
        description: Number of days since the account balance was last checked.

      - name: last_refreshed
        description: Timestamp when the account was last successfully refreshed or
                     aggregated, normalized across providers.

      - name: days_since_last_refreshed
        description: Number of days since the account was last successfully refreshed.

      - name: is_data_stale
        description: Indicates whether the account data is considered stale based on
                     provider-specific freshness rules.
        tests:
          - accepted_values:
              arguments:
                values: 
                  - true
                  - false

      - name: last_refresh_attempt
        description: Timestamp of the most recent attempt to refresh account data.

      - name: days_since_last_refresh_attempt
        description: Number of days since the last refresh attempt.

      - name: created_date
        description: Date when the account was first created in the system.
        tests:
          - not_null

      - name: account_age_in_days
        description: Age of the account in days since creation.

      - name: account_age_in_months
        description: Age of the account in months since creation.

      - name: last_updated
        description: Timestamp when the account record was last updated.

      - name: account_src
        description: Source provider from which the account record originated.
        tests:
          - accepted_values:
              arguments:
                values: ['source 1', 'source 2', 'Source 3']

      - name: aggregation_source
        description: Source system or method used to aggregate the account data.
